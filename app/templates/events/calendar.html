{% extends "layout.html" %}
{% block content %}

<h3>Event Calendar</h3>

<!-- FullCalendar CSS -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css">

<!-- Calendar Container -->
<div id="calendar"></div>

<!-- EVENT DETAILS MODAL -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>

        <h3 id="modalTitle"></h3>

        <p><strong>Start:</strong> <span id="modalStart"></span></p>
        <p><strong>End:</strong> <span id="modalEnd"></span></p>

        <div class="modal-actions">
            <a id="editBtn" class="edit-btn">Edit</a>

            <button type="button"
                    class="btn-delete"
                    onclick="openConfirmModal(currentDeleteUrl)">
                Delete
            </button>

            <button class="btn-secondary" onclick="closeModal()">Close</button>
        </div>
    </div>
</div>

<!-- FullCalendar JS (ONLY ONCE) -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<script>
let currentDeleteUrl = null;

document.addEventListener("DOMContentLoaded", function () {

    const calendarEl = document.getElementById("calendar");

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",

        headerToolbar: {
            left: "prev,next today",
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay"
        },

        events: "/events/api",

        eventClick: function(info) {
            info.jsEvent.preventDefault();

            const event = info.event;

            document.getElementById("modalTitle").innerText = event.title;
            document.getElementById("modalStart").innerText =
                event.start.toLocaleString();
            document.getElementById("modalEnd").innerText =
                event.end ? event.end.toLocaleString() : "N/A";

            document.getElementById("editBtn").href =
                `/events/?edit=${event.id}`;

            currentDeleteUrl =
                `/events/delete/${event.id}`;

            document.getElementById("eventModal").style.display = "block";
        }
    });

    calendar.render();
});

function closeModal() {
    document.getElementById("eventModal").style.display = "none";
}
</script>

{% endblock %}
